<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø´ÙƒØ§ÙˆÙ‰ Ø§Ù„Ø·Ù„Ø§Ø¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --gold-primary: #D4AF37;
            --gold-light: #F4E4B0;
            --gold-dark: #B8941F;
        }

        .logo img {
            height: 160px; 
            width: 27vw;
            display: block;
            position: absolute;
            top: -15px;
            right: 80px;
        }
        
        [dir="rtl"] { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .dark {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e2e8f0;
        }
        
        .dark .card {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        .dark input, .dark textarea, .dark select {
            background-color: #374151;
            color: #e2e8f0;
            border-color: var(--gold-dark);
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.15);
            margin-bottom: 20px;
            border: 1px solid rgba(212, 175, 55, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dark) 100%);
            color: #1a1a2e;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 700;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.5);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }
        
        .btn-edit {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 700;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);
        }
        
        .btn-edit:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.5);
        }

        .btn-delete {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 700;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3);
        }
        
        .btn-delete:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.5);
        }
        
        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--gold-light);
            border-radius: 12px;
            margin-top: 8px;
            transition: all 0.3s;
            background: white;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }
        
        .label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
            display: block;
        }
        
        .dark .label {
            color: var(--gold-light);
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .status-pending {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border: 2px solid #f59e0b;
        }
        
        .status-inprogress {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
            border: 2px solid #3b82f6;
        }
        
        .status-resolved {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            border: 2px solid #10b981;
        }
        
        .status-closed {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            color: #374151;
            border: 2px solid #9ca3af;
        }
        
        .tab {
            cursor: pointer;
            padding: 14px 28px;
            border-bottom: 4px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
            color: #6b7280;
        }
        
        .tab:hover {
            color: var(--gold-dark);
            background: rgba(212, 175, 55, 0.05);
        }
        
        .tab.active {
            border-bottom-color: var(--gold-primary);
            color: var(--gold-dark);
            background: rgba(212, 175, 55, 0.1);
        }
        
        .hidden {
            display: none !important;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            color: white;
            font-weight: 600;
            min-width: 300px;
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .notification.info {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dark) 100%);
            color: #1a1a2e;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .header-gradient {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, var(--gold-dark) 100%);
        }
        
        .stat-card {
            border-radius: 16px;
            padding: 24px;
            color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }
        
        thead th {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dark) 100%);
            color: #1a1a2e;
            font-weight: 700;
            padding: 14px;
            text-align: right;
            border: none;
        }
        
        thead th:first-child {
            border-top-right-radius: 12px;
            border-bottom-right-radius: 12px;
        }
        
        thead th:last-child {
            border-top-left-radius: 12px;
            border-bottom-left-radius: 12px;
        }
        
        tbody tr {
            background: white;
            transition: all 0.3s;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .dark tbody tr {
            background: #1f2937;
        }
        
        tbody tr:hover {
            transform: translateX(-5px);
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.2);
        }
        
        tbody td {
            padding: 14px;
            border: none;
        }
        
        tbody tr td:first-child {
            border-top-right-radius: 12px;
            border-bottom-right-radius: 12px;
        }
        
        tbody tr td:last-child {
            border-top-left-radius: 12px;
            border-bottom-left-radius: 12px;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            padding: 6px;
            transition: transform 0.2s;
            border-radius: 8px;
        }
        
        .action-btn:hover {
            transform: scale(1.2);
            background: rgba(212, 175, 55, 0.1);
        }

        .edit-mode-banner {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 3px solid var(--gold-primary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); }
            50% { box-shadow: 0 0 20px 10px rgba(212, 175, 55, 0); }
        }

        @media print {
            body * {
                visibility: hidden;
            }
            #printableReport, #printableReport * {
                visibility: visible;
            }
            #printableReport {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .print-hide {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="header-gradient text-white py-6 shadow-2xl">
        <div class="container mx-auto px-4 flex justify-between items-center flex-wrap gap-4">
            <div class="flex items-center gap-4">
                <img src="logo.png" alt="Logo" style="height: 80px; width: auto;">
                <div>
                    <p class="text-sm mt-1" id="headerSubtitle" style="color: var(--gold-light);">
                        <span id="userRoleDisplay"></span>
                    </p>
                </div>
            </div>
            
            <div class="flex gap-3 items-center flex-wrap">
                <button onclick="toggleDarkMode()" class="btn-secondary">
                    ğŸŒ“ <span id="darkModeText">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</span>
                </button>
                <button onclick="showChangePassword()" class="btn-secondary" id="changePassBtn" style="display: none;">
                    ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                </button>
                <button onclick="showUserManagement()" class="btn-secondary" id="userMgmtBtn" style="display: none;">
                    ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                </button>
                <button onclick="showSettings()" class="btn-secondary" id="settingsBtn" style="display: none;">
                    âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                </button>
                <button onclick="logout()" class="btn-primary" id="logoutBtn" style="display: none;">
                    ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- Login Section -->
        <div id="loginSection">
            <div class="card max-w-md mx-auto">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold" style="color: var(--gold-dark);">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                    <p class="text-sm text-gray-600 mt-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</p>
                </div>
                
                <div class="mb-4">
                    <label class="label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="loginUsername" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                </div>
                <div class="mb-4">
                    <label class="label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="loginPassword" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                </div>
                <div class="mb-6">
                    <label class="label">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
                    <select id="loginRole" class="input-field">
                        <option value="employee">ğŸ‘¨â€ğŸ’¼ Ø§Ù„Ù…ÙˆØ¸Ù (Employee)</option>
                        <option value="reviewer">ğŸ‘ï¸ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ (Reviewer)</option>
                        <option value="admin">ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ± (Admin)</option>
                    </select>
                </div>
                <button onclick="login()" class="btn-primary w-full">
                    ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </div>
        </div>

        <!-- Change Password Modal -->
        <div id="changePasswordModal" class="hidden">
            <div class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-md w-full shadow-2xl" style="border: 3px solid var(--gold-primary);">
                    <h2 class="text-2xl font-bold mb-6" style="color: var(--gold-dark);">ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2>
                    
                    <div class="mb-4">
                        <label class="label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                        <input type="password" id="currentPassword" class="input-field">
                    </div>
                    <div class="mb-4">
                        <label class="label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                        <input type="password" id="newPassword" class="input-field">
                    </div>
                    <div class="mb-6">
                        <label class="label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                        <input type="password" id="confirmPassword" class="input-field">
                    </div>
                    
                    <div class="flex gap-4">
                        <button onclick="saveNewPassword()" class="btn-primary flex-1">ğŸ’¾ Ø­ÙØ¸</button>
                        <button onclick="hideChangePassword()" class="btn-secondary flex-1">âŒ Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Management Section (Admin Only) -->
        <div id="userManagementSection" class="hidden">
            <div class="card max-w-6xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold" style="color: var(--gold-dark);">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
                    <button onclick="hideUserManagement()" class="btn-secondary">Ø±Ø¬ÙˆØ¹</button>
                </div>

                <div class="card mb-6" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
                    <h3 class="text-xl font-bold mb-4" style="color: var(--gold-dark);">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
                    <div class="grid md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                            <input type="text" id="newUserUsername" class="input-field">
                        </div>
                        <div>
                            <label class="label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                            <input type="password" id="newUserPassword" class="input-field">
                        </div>
                        <div>
                            <label class="label">Ø§Ù„Ø¯ÙˆØ±</label>
                            <select id="newUserRole" class="input-field">
                                <option value="employee">ğŸ‘¨â€ğŸ’¼ Ø§Ù„Ù…ÙˆØ¸Ù</option>
                                <option value="reviewer">ğŸ‘ï¸ Ø§Ù„Ù…ØªØ§Ø¨Ø¹</option>
                                <option value="admin">ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ±</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="addNewUser()" class="btn-primary">âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
                </div>

                <div class="overflow-x-auto">
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                <th>Ø§Ù„Ø¯ÙˆØ±</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Settings Section (Admin Only) -->
        <div id="settingsSection" class="hidden">
            <div class="card max-w-4xl mx-auto">
                <div class="flex items-center gap-3 mb-6">
                    <svg class="w-8 h-8" fill="var(--gold-primary)" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                    </svg>
                    <h2 class="text-2xl font-bold" style="color: var(--gold-dark);">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
                </div>
                
                <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px dashed var(--gold-primary); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 class="text-xl font-bold mb-4" style="color: var(--gold-dark);">ğŸ”— Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†:</h3>
                    <select id="storageMethod" class="input-field mb-4" onchange="updateStorageConfig()">
                        <option value="local">Local Storage</option>
                        <option value="powerautomate">Power Automate</option>
                        <option value="api">Python Api</option>
                        <option value="graphapi">Microsoft Graph API</option>
                    </select>
                </div>

                <div class="flex gap-4">
                    <button onclick="saveSettings()" class="btn-primary flex-1">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                    <button onclick="hideSettings()" class="btn-secondary flex-1">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>

        <!-- Main Section -->
        <div id="mainSection" class="hidden">
            <!-- Main Navigation -->
            <div class="card">
                <div class="flex border-b-2 overflow-x-auto" style="border-color: var(--gold-light);">
                    <div class="tab active" onclick="showTab('new')" id="tabNew">â• ØªØ³Ø¬ÙŠÙ„ Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©</div>
                    <div class="tab" onclick="showTab('view')" id="tabView">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</div>
                    <div class="tab" onclick="showTab('dashboard')" id="tabDashboard">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
                    <div class="tab" onclick="showTab('reports')" id="tabReports">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
                </div>
            </div>

            <!-- Complaint Form Section -->
            <div id="complaintFormSection" class="hidden">
                <div class="card">
                    <div id="editModeBanner" class="hidden edit-mode-banner">
                        <h3 class="text-2xl font-bold" style="color: var(--gold-dark);">âœï¸ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</h3>
                        <p class="text-lg mt-2" style="color: #92400e;">
                            Ø¬Ø§Ø±ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰ Ø±Ù‚Ù…: <strong id="editingComplaintId"></strong>
                        </p>
                    </div>

                    <h2 class="text-2xl font-bold mb-6" id="formTitle" style="color: var(--gold-dark);">â• ØªØ³Ø¬ÙŠÙ„ Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©</h2>
                    
                    <h3 class="text-xl font-semibold mb-4" style="color: var(--gold-primary);">ğŸ‘¨â€ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø·Ø§Ù„Ø¨ *</label>
                            <input type="text" id="studentName" class="input-field" required>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„Ù†Ø¸Ø§Ù…/Ø§Ù„Ù…Ù†Ù‡Ø¬ *</label>
                            <select id="curriculum" class="input-field" onchange="updateGradeOptions()">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†Ø¸Ø§Ù…</option>
                                <option value="National">National</option>
                                <option value="International">International</option>
                                <option value="Online">Online</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„ØµÙ (Grade/Year) *</label>
                            <select id="grade" class="input-field" onchange="updateSectionOptions()">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹</option>
                            </select>
                        </div>
                        <div id="subCurriculumDiv" class="hidden">
                            <label class="label">Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„ÙØ±Ø¹ÙŠ (Ù„Ù„Ø³Ù†ÙˆØ§Øª 10-12 Ø¯ÙˆÙ„ÙŠ) *</label>
                            <select id="subCurriculum" class="input-field">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ù‡Ø¬</option>
                                <option value="American">American</option>
                                <option value="British">British</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„ÙØµÙ„ *</label>
                            <select id="section" class="input-field">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø£ÙˆÙ„Ø§Ù‹</option>
                            </select>
                        </div>
                    </div>

                    <h3 class="text-xl font-semibold mb-4" style="color: var(--gold-primary);">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="label">Ø§Ø³Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± *</label>
                            <input type="text" id="guardianName" class="input-field" required>
                        </div>
                        <div>
                            <label class="label">ØµÙ„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¨Ø© *</label>
                            <select id="relation" class="input-field">
                                <option value="Father">Father - Ø£Ø¨</option>
                                <option value="Mother">Mother - Ø£Ù…</option>
                                <option value="Guardian">Guardian - ÙˆÙ„ÙŠ Ø£Ù…Ø±</option>
                                <option value="Other">Other - Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                            <input type="tel" id="phone" class="input-field" placeholder="+20XXXXXXXXXX" required>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                            <input type="email" id="email" class="input-field" placeholder="optional@example.com">
                        </div>
                    </div>

                    <h3 class="text-xl font-semibold mb-4" style="color: var(--gold-primary);">ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰</h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© *</label>
                            <select id="complaintType" class="input-field">
                                <option value="Behavior">Behavior - Ø³Ù„ÙˆÙƒÙŠ</option>
                                <option value="Academic">Academic - Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</option>
                                <option value="Health">Health - ØµØ­ÙŠ</option>
                                <option value="General">General - Ø¹Ø§Ù…</option>
                                <option value="Technology">Technology - ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§</option>
                                <option value="Other">Other - Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ù†ÙŠ *</label>
                            <select id="department" class="input-field">
                                <option value="Student Affairs">Student Affairs - Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨</option>
                                <option value="IT">IT - ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                                <option value="Discipline">Discipline - Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·</option>
                                <option value="Academic Dept">Academic Dept - Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</option>
                                <option value="Health">Health - Ø§Ù„ØµØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©</option>
                                <option value="Administration">Administration - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© *</label>
                            <select id="priority" class="input-field">
                                <option value="Ø¹Ø§Ø¬Ù„">ğŸ”´ Ø¹Ø§Ø¬Ù„</option>
                                <option value="Ù…Ø±ØªÙØ¹">ğŸŸ  Ù…Ø±ØªÙØ¹</option>
                                <option value="Ù…ØªÙˆØ³Ø·" selected>ğŸŸ¡ Ù…ØªÙˆØ³Ø·</option>
                                <option value="Ù…Ù†Ø®ÙØ¶">ğŸŸ¢ Ù…Ù†Ø®ÙØ¶</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</label>
                            <select id="assignedTo" class="input-field">
                                <option value="">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†</option>
                                <option value="Student Affairs">Student Affairs - Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨</option>
                                <option value="IT">IT - ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                                <option value="Discipline">Discipline - Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø·</option>
                                <option value="Academic Dept">Academic Dept - Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</option>
                                <option value="Health">Health - Ø§Ù„ØµØ­Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©</option>
                            </select>
                        </div>
                        <div>
                            <label class="label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                            <select id="status" class="input-field">
                                <option value="Pending">â³ Pending - Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                                <option value="In Progress">ğŸ”„ In Progress - Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                                <option value="Resolved">âœ… Resolved - ØªÙ… Ø§Ù„Ø­Ù„</option>
                                <option value="Closed">ğŸ”’ Closed - Ù…ØºÙ„Ù‚</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="label">ÙˆØµÙ Ù…ÙØµÙ„ Ù„Ù„Ù…Ø´ÙƒÙ„Ø© *</label>
                        <textarea id="description" class="input-field" rows="5" required></textarea>
                    </div>
                    <div class="mb-6">
                        <label class="label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</label>
                        <textarea id="adminNotes" class="input-field" rows="3"></textarea>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="submitComplaint()" class="btn-primary flex-1" id="submitBtn">
                            <span id="submitBtnText">âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰</span>
                        </button>
                        <button onclick="cancelEdit()" class="btn-secondary flex-1" id="cancelBtn" style="display: none;">
                            âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                        </button>
                    </div>
                </div>
            </div>

            <!-- View Complaints Section -->
            <div id="viewComplaintsSection" class="hidden">
                <div class="card">
                    <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                        <h2 class="text-2xl font-bold" style="color: var(--gold-dark);">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</h2>
                    </div>
                    
                    <div class="grid md:grid-cols-4 gap-4 mb-6">
                        <input type="text" id="searchFilter" placeholder="ğŸ” Ø¨Ø­Ø«..." class="input-field" oninput="filterComplaints()">
                        <select id="statusFilter" class="input-field" onchange="filterComplaints()">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                            <option value="Pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                            <option value="In Progress">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                            <option value="Resolved">ØªÙ… Ø§Ù„Ø­Ù„</option>
                            <option value="Closed">Ù…ØºÙ„Ù‚</option>
                        </select>
                        <select id="priorityFilter" class="input-field" onchange="filterComplaints()">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª</option>
                            <option value="Ø¹Ø§Ø¬Ù„">ğŸ”´ Ø¹Ø§Ø¬Ù„</option>
                            <option value="Ù…Ø±ØªÙØ¹">ğŸŸ  Ù…Ø±ØªÙØ¹</option>
                            <option value="Ù…ØªÙˆØ³Ø·">ğŸŸ¡ Ù…ØªÙˆØ³Ø·</option>
                            <option value="Ù…Ù†Ø®ÙØ¶">ğŸŸ¢ Ù…Ù†Ø®ÙØ¶</option>
                        </select>
                        <select id="typeFilter" class="input-field" onchange="filterComplaints()">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                            <option value="Behavior">Ø³Ù„ÙˆÙƒÙŠ</option>
                            <option value="Academic">Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</option>
                            <option value="Health">ØµØ­ÙŠ</option>
                            <option value="General">Ø¹Ø§Ù…</option>
                            <option value="Technology">ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§</option>
                            <option value="Other">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <button onclick="exportToExcel()" class="btn-primary">ğŸ“¥ ØªØµØ¯ÙŠØ± Excel</button>
                    </div>

                    <div id="complaintsTable"></div>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboardSection" class="hidden">
                <div class="grid md:grid-cols-4 gap-4 mb-6">
                    <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                        <h3 class="text-lg font-semibold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</h3>
                        <p class="text-5xl font-bold mt-3" id="totalCount">0</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                        <h3 class="text-lg font-semibold">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h3>
                        <p class="text-5xl font-bold mt-3" id="pendingCount">0</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                        <h3 class="text-lg font-semibold">ØªÙ… Ø§Ù„Ø­Ù„</h3>
                        <p class="text-5xl font-bold mt-3" id="resolvedCount">0</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dark) 100%);">
                        <h3 class="text-lg font-semibold">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø­Ù„</h3>
                        <p class="text-5xl font-bold mt-3" id="avgTime">-</p>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--gold-dark);">Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹</h3>
                        <canvas id="typeChart"></canvas>
                    </div>
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--gold-dark);">Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©</h3>
                        <canvas id="statusChart"></canvas>
                    </div>
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--gold-dark);">Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</h3>
                        <canvas id="priorityChart"></canvas>
                    </div>
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--gold-dark);">Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</h3>
                        <canvas id="curriculumChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reportsSection" class="hidden">
                <div class="card">
                    <h2 class="text-2xl font-bold mb-6" style="color: var(--gold-dark);">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h2>
                    
                    <div class="grid md:grid-cols-3 gap-4 mb-6">
                        <div>
                            <label class="label">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="fromDate" class="input-field">
                        </div>
                        <div>
                            <label class="label">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="toDate" class="input-field">
                        </div>
                        <div class="flex items-end gap-2">
                            <button onclick="generateReport()" class="btn-primary flex-1">ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ±</button>
                        </div>
                    </div>
                    
                    <div id="reportOutput"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let complaints = [];
        let currentUser = null;
        let isDark = false;
        let isEditMode = false;
        let editingComplaintId = null;
        let config = {
            storageMethod: 'local',
            flowUrl: '',
            apiUrl: 'http://localhost:5000',
            tenantId: '',
            clientId: '',
            clientSecret: '',
            driveId: '',
            fileId: ''
        };

        let users = {
            employee: { username: 'employee', password: 'emp123', role: 'employee', roleName: 'Ø§Ù„Ù…ÙˆØ¸Ù' },
            reviewer: { username: 'reviewer', password: 'rev123', role: 'reviewer', roleName: 'Ø§Ù„Ù…ØªØ§Ø¨Ø¹' },
            admin: { username: 'admin', password: 'admin123', role: 'admin', roleName: 'Ø§Ù„Ù…Ø¯ÙŠØ±' }
        };

        const classesByGrade = {
            'KG1': ['Boo', 'Dolphin', 'Lions', 'Nemo', 'Simba', 'Snow white', 'Winnie'],
            'KG2': ['Belle', 'Dora', 'Mermaid', 'Mickey', 'Moana', 'Tweety', 'Elsa', 'Ben10'],
            'Grade 1': ['1A', '1B', '1C', '1D', '1E', '1F', '1G'],
            'Grade 2': ['2A', '2B', '2C', '2D', '2E', '2F', '2G'],
            'Grade 3': ['3A', '3B', '3C', '3D', '3E', '3F'],
            'Grade 4': ['4A', '4B', '4C', '4D'],
            'Grade 5': ['5A', '5B', '5C'],
            'Grade 6': ['6A', '6B', '6C'],
            'Grade 7': ['7A', '7B'],
            'Grade 8': ['8A', '8B'],
            'Grade 9': ['9A'],
            'Grade 10': ['10A'],
            'Grade 11': ['11A']
        };

        function loadData() {
            const saved = localStorage.getItem('complaints');
            if (saved) complaints = JSON.parse(saved);
            
            const savedUsers = localStorage.getItem('systemUsers');
            if (savedUsers) users = JSON.parse(savedUsers);
            
            const savedConfig = localStorage.getItem('systemConfig');
            if (savedConfig) config = { ...config, ...JSON.parse(savedConfig) };
        }

        function saveData() {
            localStorage.setItem('complaints', JSON.stringify(complaints));
        }

        function saveUsers() {
            localStorage.setItem('systemUsers', JSON.stringify(users));
        }

        function checkAuth() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainSection();
            } else {
                showLoginSection();
            }
        }

        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const role = document.getElementById('loginRole').value;

            if (!username || !password) {
                showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                return;
            }

            if (users[role] && users[role].username === username && users[role].password === password) {
                currentUser = {
                    username: username,
                    role: role,
                    roleName: users[role].roleName,
                    loginTime: new Date().toISOString()
                };

                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMainSection();
                showNotification(`âœ… Ù…Ø±Ø­Ø¨Ø§Ù‹ ${users[role].roleName}!`, 'success');
            } else {
                showNotification('âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
            }
        }

        function logout() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                localStorage.removeItem('currentUser');
                currentUser = null;
                location.reload();
            }
        }

        function showLoginSection() {
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('mainSection').classList.add('hidden');
            document.getElementById('userManagementSection').classList.add('hidden');
            document.getElementById('settingsSection').classList.add('hidden');
        }

        function showMainSection() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('mainSection').classList.remove('hidden');
            document.getElementById('userManagementSection').classList.add('hidden');
            document.getElementById('settingsSection').classList.add('hidden');
            
            document.getElementById('userRoleDisplay').textContent = `${currentUser.roleName} - ${currentUser.username}`;
            document.getElementById('logoutBtn').style.display = 'block';
            
            if (currentUser.role === 'admin') {
                document.getElementById('changePassBtn').style.display = 'block';
                document.getElementById('userMgmtBtn').style.display = 'block';
                document.getElementById('settingsBtn').style.display = 'block';
            } else {
                document.getElementById('changePassBtn').style.display = 'none';
                document.getElementById('userMgmtBtn').style.display = 'none';
                document.getElementById('settingsBtn').style.display = 'none';
            }

            showTab('new');
        }

        function showChangePassword() {
            if (currentUser.role !== 'admin') {
                showNotification('âŒ ÙÙ‚Ø· Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙ…ÙƒÙ†Ù‡ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                return;
            }
            document.getElementById('changePasswordModal').classList.remove('hidden');
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        function hideChangePassword() {
            document.getElementById('changePasswordModal').classList.add('hidden');
        }

        function saveNewPassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;

            if (!current || !newPass || !confirm) {
                showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }

            if (users[currentUser.role].password !== current) {
                showNotification('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                return;
            }

            if (newPass !== confirm) {
                showNotification('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©', 'error');
                return;
            }

            if (newPass.length < 6) {
                showNotification('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                return;
            }

            users[currentUser.role].password = newPass;
            saveUsers();
            hideChangePassword();
            showNotification('âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function showUserManagement() {
            if (currentUser.role !== 'admin') {
                showNotification('âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„', 'error');
                return;
            }
            document.getElementById('userManagementSection').classList.remove('hidden');
            document.getElementById('mainSection').classList.add('hidden');
            renderUsersTable();
        }

        function hideUserManagement() {
            document.getElementById('userManagementSection').classList.add('hidden');
            document.getElementById('mainSection').classList.remove('hidden');
        }

        function renderUsersTable() {
            let html = '';
            Object.keys(users).forEach(key => {
                const user = users[key];
                html += `<tr>
                    <td class="font-bold">${user.username}</td>
                    <td>${user.roleName}</td>
                    <td>
                        <div style="display: flex; gap: 8px; justify-content: center;">
                            <button onclick="editUser('${key}')" class="btn-edit">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                            <button onclick="deleteUser('${key}')" class="btn-delete">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        </div>
                    </td>
                </tr>`;
            });
            document.getElementById('usersTableBody').innerHTML = html;
        }

        function addNewUser() {
            const username = document.getElementById('newUserUsername').value;
            const password = document.getElementById('newUserPassword').value;
            const role = document.getElementById('newUserRole').value;

            if (!username || !password) {
                showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }

            if (password.length < 6) {
                showNotification('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                return;
            }

            const userKey = username.toLowerCase().replace(/\s/g, '_');
            
            if (users[userKey]) {
                showNotification('âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                return;
            }

            const roleNames = { employee: 'Ø§Ù„Ù…ÙˆØ¸Ù', reviewer: 'Ø§Ù„Ù…ØªØ§Ø¨Ø¹', admin: 'Ø§Ù„Ù…Ø¯ÙŠØ±' };

            users[userKey] = {
                username: username,
                password: password,
                role: role,
                roleName: roleNames[role]
            };

            saveUsers();
            document.getElementById('newUserUsername').value = '';
            document.getElementById('newUserPassword').value = '';
            renderUsersTable();
            showNotification('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function editUser(key) {
            const user = users[key];
            const newUsername = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:', user.username);
            if (newUsername && newUsername !== user.username) {
                user.username = newUsername;
                saveUsers();
                renderUsersTable();
                showNotification('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'success');
            }

            const changePass = confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ');
            if (changePass) {
                const newPassword = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:');
                if (newPassword && newPassword.length >= 6) {
                    user.password = newPassword;
                    saveUsers();
                    showNotification('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'success');
                } else if (newPassword) {
                    showNotification('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹', 'error');
                }
            }
        }

        function deleteUser(key) {
            if (key === currentUser.role && users[key].username === currentUser.username) {
                showNotification('âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ', 'error');
                return;
            }

            if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${users[key].username}ØŸ`)) {
                delete users[key];
                saveUsers();
                renderUsersTable();
                showNotification('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'success');
            }
        }

        function toggleDarkMode() {
            isDark = !isDark;
            document.body.classList.toggle('dark', isDark);
        }

        function showSettings() {
            if (currentUser.role !== 'admin') {
                showNotification('âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'error');
                return;
            }
            document.getElementById('settingsSection').classList.remove('hidden');
            document.getElementById('mainSection').classList.add('hidden');
            document.getElementById('storageMethod').value = config.storageMethod;
        }

        function saveSettings() {
            config.storageMethod = document.getElementById('storageMethod').value;
            localStorage.setItem('systemConfig', JSON.stringify(config));
            showNotification('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
            hideSettings();
        }

        function hideSettings() {
            document.getElementById('settingsSection').classList.add('hidden');
            document.getElementById('mainSection').classList.remove('hidden');
        }

        function showTab(tab) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => t.classList.remove('active'));
            
            document.getElementById('complaintFormSection').classList.add('hidden');
            document.getElementById('viewComplaintsSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('reportsSection').classList.add('hidden');

            switch(tab) {
                case 'new':
                    document.querySelector('[onclick="showTab(\'new\')"]').classList.add('active');
                    document.getElementById('complaintFormSection').classList.remove('hidden');
                    if (!isEditMode) clearForm();
                    break;
                case 'view':
                    document.querySelector('[onclick="showTab(\'view\')"]').classList.add('active');
                    document.getElementById('viewComplaintsSection').classList.remove('hidden');
                    renderComplaints();
                    break;
                case 'dashboard':
                    document.querySelector('[onclick="showTab(\'dashboard\')"]').classList.add('active');
                    document.getElementById('dashboardSection').classList.remove('hidden');
                    renderDashboard();
                    break;
                case 'reports':
                    document.querySelector('[onclick="showTab(\'reports\')"]').classList.add('active');
                    document.getElementById('reportsSection').classList.remove('hidden');
                    break;
            }
        }

        function clearForm() {
            document.getElementById('studentName').value = '';
            document.getElementById('curriculum').selectedIndex = 0;
            document.getElementById('grade').innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø£ÙˆÙ„Ø§Ù‹</option>';
            document.getElementById('section').innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø£ÙˆÙ„Ø§Ù‹</option>';
            document.getElementById('guardianName').value = '';
            document.getElementById('relation').selectedIndex = 0;
            document.getElementById('phone').value = '';
            document.getElementById('email').value = '';
            document.getElementById('complaintType').selectedIndex = 0;
            document.getElementById('department').selectedIndex = 0;
            document.getElementById('priority').selectedIndex = 2;
            document.getElementById('assignedTo').selectedIndex = 0;
            document.getElementById('status').selectedIndex = 0;
            document.getElementById('description').value = '';
            document.getElementById('adminNotes').value = '';
            document.getElementById('subCurriculumDiv').classList.add('hidden');
            
            isEditMode = false;
            editingComplaintId = null;
            document.getElementById('formTitle').innerHTML = 'â• ØªØ³Ø¬ÙŠÙ„ Ø´ÙƒÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ø©';
            document.getElementById('submitBtnText').textContent = 'âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰';
            document.getElementById('editModeBanner').classList.add('hidden');
            document.getElementById('cancelBtn').style.display = 'none';
        }

        function updateGradeOptions() {
            const curriculum = document.getElementById('curriculum').value;
            const gradeSelect = document.getElementById('grade');
            
            gradeSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>';
            document.getElementById('section').innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø£ÙˆÙ„Ø§Ù‹</option>';
            
            if (curriculum === 'National' || curriculum === 'Online') {
                const grades = ['KG1', 'KG2', 'Grade 1', 'Grade 2', 'Grade 3', 'Grade 4', 'Grade 5', 
                    'Grade 6', 'Grade 7', 'Grade 8', 'Grade 9', 'Grade 10', 'Grade 11', 'Grade 12'];
                grades.forEach(grade => {
                    gradeSelect.innerHTML += `<option value="${grade}">${grade}</option>`;
                });
            } else if (curriculum === 'International') {
                const years = ['FS1', 'FS2', 'Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5', 'Year 6',
                    'Year 7', 'Year 8', 'Year 9', 'Year 10', 'Year 11', 'Year 12'];
                years.forEach(year => {
                    gradeSelect.innerHTML += `<option value="${year}">${year}</option>`;
                });
            }
            
            document.getElementById('subCurriculumDiv').classList.add('hidden');
        }

        function updateSectionOptions() {
            const grade = document.getElementById('grade').value;
            const curriculum = document.getElementById('curriculum').value;
            const sectionSelect = document.getElementById('section');
            
            sectionSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„</option>';
            
            if (grade && classesByGrade[grade]) {
                classesByGrade[grade].forEach(section => {
                    sectionSelect.innerHTML += `<option value="${section}">${section}</option>`;
                });
            }
            
            if (curriculum === 'International' && (grade === 'Year 10' || grade === 'Year 11' || grade === 'Year 12')) {
                document.getElementById('subCurriculumDiv').classList.remove('hidden');
            } else {
                document.getElementById('subCurriculumDiv').classList.add('hidden');
                document.getElementById('subCurriculum').selectedIndex = 0;
            }
        }

        function editComplaint(id) {
            const complaint = complaints.find(c => c.id === id);
            if (!complaint) {
                showNotification('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙƒÙˆÙ‰', 'error');
                return;
            }

            document.getElementById('studentName').value = complaint.studentName;
            
            document.getElementById('curriculum').value = complaint.curriculum;
            updateGradeOptions();
            
            setTimeout(() => {
                document.getElementById('grade').value = complaint.grade;
                updateSectionOptions();
                
                setTimeout(() => {
                    document.getElementById('section').value = complaint.section || '';
                    
                    if (complaint.subCurriculum) {
                        document.getElementById('subCurriculumDiv').classList.remove('hidden');
                        document.getElementById('subCurriculum').value = complaint.subCurriculum;
                    }
                }, 100);
            }, 100);

            document.getElementById('guardianName').value = complaint.guardianName;
            document.getElementById('relation').value = complaint.relation;
            document.getElementById('phone').value = complaint.phone;
            document.getElementById('email').value = complaint.email || '';
            
            document.getElementById('complaintType').value = complaint.type;
            document.getElementById('department').value = complaint.department;
            document.getElementById('priority').value = complaint.priority || 'Ù…ØªÙˆØ³Ø·';
            document.getElementById('assignedTo').value = complaint.assignedTo || '';
            document.getElementById('status').value = complaint.status;
            document.getElementById('description').value = complaint.description;
            document.getElementById('adminNotes').value = complaint.adminNotes || '';

            isEditMode = true;
            editingComplaintId = id;
            document.getElementById('formTitle').innerHTML = 'âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰';
            document.getElementById('submitBtnText').textContent = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';
            document.getElementById('editModeBanner').classList.remove('hidden');
            document.getElementById('editingComplaintId').textContent = id;
            document.getElementById('cancelBtn').style.display = 'block';

            showTab('new');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            showNotification(`âœï¸ Ø¬Ø§Ø±ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰ ${id}`, 'info');
        }

        function cancelEdit() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŸ')) {
                clearForm();
                showTab('view');
            }
        }

        function submitComplaint() {
            const complaintData = {
                studentName: document.getElementById('studentName').value,
                curriculum: document.getElementById('curriculum').value,
                grade: document.getElementById('grade').value,
                section: document.getElementById('section').value,
                subCurriculum: document.getElementById('subCurriculum').value,
                guardianName: document.getElementById('guardianName').value,
                relation: document.getElementById('relation').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                type: document.getElementById('complaintType').value,
                department: document.getElementById('department').value,
                priority: document.getElementById('priority').value,
                assignedTo: document.getElementById('assignedTo').value,
                status: document.getElementById('status').value,
                description: document.getElementById('description').value,
                adminNotes: document.getElementById('adminNotes').value
            };

            if (isEditMode && editingComplaintId) {
                const index = complaints.findIndex(c => c.id === editingComplaintId);
                if (index !== -1) {
                    const oldComplaint = complaints[index];
                    
                    complaints[index] = {
                        ...oldComplaint,
                        ...complaintData,
                        id: oldComplaint.id,
                        createdBy: oldComplaint.createdBy,
                        createdByRole: oldComplaint.createdByRole,
                        createdAt: oldComplaint.createdAt,
                        updatedAt: new Date().toISOString(),
                        activityLog: [
                            ...(oldComplaint.activityLog || []),
                            {
                                action: 'Updated',
                                user: currentUser.username,
                                role: currentUser.roleName,
                                timestamp: new Date().toISOString(),
                                changes: 'ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙƒÙˆÙ‰'
                            }
                        ]
                    };

                    saveData();
                    showNotification(`âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰ ${editingComplaintId} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                    clearForm();
                    setTimeout(() => showTab('view'), 1500);
                } else {
                    showNotification('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙƒÙˆÙ‰', 'error');
                }
            } else {
                const complaint = {
                    id: `2025-${String(complaints.length + 1).padStart(4, '0')}`,
                    ...complaintData,
                    createdBy: currentUser.username,
                    createdByRole: currentUser.roleName,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    activityLog: [{
                        action: 'Created',
                        user: currentUser.username,
                        role: currentUser.roleName,
                        timestamp: new Date().toISOString()
                    }]
                };

                complaints.push(complaint);
                saveData();
                showNotification(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰! Ø±Ù‚Ù…: ${complaint.id}`, 'success');
                clearForm();
                setTimeout(() => showTab('view'), 1500);
            }
        }

        function renderComplaints() {
            let filtered = filterComplaintsData();
            
            const priorityOrder = { 'Ø¹Ø§Ø¬Ù„': 1, 'Ù…Ø±ØªÙØ¹': 2, 'Ù…ØªÙˆØ³Ø·': 3, 'Ù…Ù†Ø®ÙØ¶': 4 };
            filtered.sort((a, b) => {
                const priorityA = priorityOrder[a.priority || 'Ù…ØªÙˆØ³Ø·'];
                const priorityB = priorityOrder[b.priority || 'Ù…ØªÙˆØ³Ø·'];
                return priorityA - priorityB;
            });

            let html = '<div class="overflow-x-auto"><table><thead><tr>';
            html += '<th>Ø±Ù‚Ù… Ø§Ù„Ø´ÙƒÙˆÙ‰</th><th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th><th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ù†Ø¸Ø§Ù…</th><th>Ø§Ù„ØµÙ</th><th>Ø§Ù„ÙØµÙ„</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th style="min-width: 250px;">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>';
            html += '</tr></thead><tbody>';

            if (filtered.length === 0) {
                html += '<tr><td colspan="11" class="text-center p-8" style="color: var(--gold-dark);">ğŸ“‹ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´ÙƒØ§ÙˆÙ‰</td></tr>';
            }

            filtered.forEach(c => {
                const statusClass = `status-${c.status.toLowerCase().replace(' ', '')}`;
                const priorityIcon = { 'Ø¹Ø§Ø¬Ù„': 'ğŸ”´', 'Ù…Ø±ØªÙØ¹': 'ğŸŸ ', 'Ù…ØªÙˆØ³Ø·': 'ğŸŸ¡', 'Ù…Ù†Ø®ÙØ¶': 'ğŸŸ¢' };
                const curriculumDisplay = c.curriculum + (c.subCurriculum ? ` (${c.subCurriculum})` : '');
                
                html += `<tr>`;
                html += `<td class="font-bold" style="color: var(--gold-dark);">${c.id}</td>`;
                html += `<td><span style="font-size: 20px;">${priorityIcon[c.priority || 'Ù…ØªÙˆØ³Ø·']} ${c.priority || 'Ù…ØªÙˆØ³Ø·'}</span></td>`;
                html += `<td><strong>${c.studentName}</strong></td>`;
                html += `<td>${curriculumDisplay}</td>`;
                html += `<td>${c.grade}</td>`;
                html += `<td><strong>${c.section || '-'}</strong></td>`;
                html += `<td>${c.type}</td>`;
                html += `<td><span class="status-badge ${statusClass}">${c.status}</span></td>`;
                html += `<td>${c.assignedTo || 'ØºÙŠØ± Ù…Ø¹ÙŠÙ†'}</td>`;
                html += `<td>${new Date(c.createdAt).toLocaleDateString('ar-EG')}</td>`;
                html += `<td><div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">`;
                
                html += `<button onclick="viewComplaint('${c.id}')" class="action-btn" title="Ø¹Ø±Ø¶" style="font-size: 24px;">ğŸ‘ï¸</button>`;
                
                if (currentUser.role === 'employee' || currentUser.role === 'reviewer' || currentUser.role === 'admin') {
                    html += `<button onclick="editComplaint('${c.id}')" class="btn-edit"><span style="font-size: 18px;">âœï¸</span><span>ØªØ¹Ø¯ÙŠÙ„</span></button>`;
                }
                
                if (currentUser.role === 'admin') {
                    html += `<button onclick="deleteComplaint('${c.id}')" class="btn-delete"><span style="font-size: 18px;">ğŸ—‘ï¸</span><span>Ø­Ø°Ù</span></button>`;
                }
                
                html += `</div></td></tr>`;
            });

            html += '</tbody></table></div>';
            document.getElementById('complaintsTable').innerHTML = html;
        }

        function filterComplaintsData() {
            const search = document.getElementById('searchFilter')?.value.toLowerCase() || '';
            const status = document.getElementById('statusFilter')?.value || '';
            const priority = document.getElementById('priorityFilter')?.value || '';
            const type = document.getElementById('typeFilter')?.value || '';

            return complaints.filter(c => {
                const matchSearch = !search || c.studentName.toLowerCase().includes(search) || c.id.toLowerCase().includes(search);
                const matchStatus = !status || c.status === status;
                const matchPriority = !priority || (c.priority || 'Ù…ØªÙˆØ³Ø·') === priority;
                const matchType = !type || c.type === type;
                return matchSearch && matchStatus && matchPriority && matchType;
            });
        }

        function filterComplaints() {
            renderComplaints();
        }

        function viewComplaint(id) {
            const c = complaints.find(x => x.id === id);
            if (!c) return;

            const priorityIcon = { 'Ø¹Ø§Ø¬Ù„': 'ğŸ”´', 'Ù…Ø±ØªÙØ¹': 'ğŸŸ ', 'Ù…ØªÙˆØ³Ø·': 'ğŸŸ¡', 'Ù…Ù†Ø®ÙØ¶': 'ğŸŸ¢' };
            const statusClass = `status-${c.status.toLowerCase().replace(' ', '')}`;

            let html = `<div class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4" onclick="this.remove()">
                <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl" onclick="event.stopPropagation()" style="border: 3px solid var(--gold-primary);">
                    <div class="flex justify-between items-start mb-6">
                        <h2 class="text-3xl font-bold" style="color: var(--gold-dark);">ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰ ${c.id}</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-4xl hover:text-red-600" style="color: var(--gold-primary);">&times;</button>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <strong>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:</strong> ${priorityIcon[c.priority || 'Ù…ØªÙˆØ³Ø·']} ${c.priority || 'Ù…ØªÙˆØ³Ø·'}
                        </div>
                        <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span class="status-badge ${statusClass}">${c.status}</span>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h3 class="text-xl font-bold mb-3" style="color: var(--gold-primary);">ğŸ‘¨â€ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
                        <div class="grid md:grid-cols-2 gap-3">
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${c.studentName}</div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„Ù†Ø¸Ø§Ù…:</strong> ${c.curriculum}${c.subCurriculum ? ` (${c.subCurriculum})` : ''}</div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„ØµÙ:</strong> ${c.grade}</div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„ÙØµÙ„:</strong> ${c.section || '-'}</div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h3 class="text-xl font-bold mb-3" style="color: var(--gold-primary);">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</h3>
                        <div class="grid md:grid-cols-2 gap-3">
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${c.guardianName}</div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>ØµÙ„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¨Ø©:</strong> ${c.relation}</div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${c.phone}</div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${c.email || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h3 class="text-xl font-bold mb-3" style="color: var(--gold-primary);">ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰</h3>
                        <div class="grid md:grid-cols-2 gap-3 mb-3">
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${c.type}</div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„Ù‚Ø³Ù…:</strong> ${c.department}</div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</strong> ${c.assignedTo || 'ØºÙŠØ± Ù…Ø¹ÙŠÙ†'}</div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(c.createdAt).toLocaleDateString('ar-EG')}</div>
                        </div>
                        <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg mb-3">
                            <strong>Ø§Ù„ÙˆØµÙ:</strong><br>${c.description}
                        </div>
                        ${c.adminNotes ? `<div class="p-4 bg-yellow-50 dark:bg-yellow-900 rounded-lg">
                            <strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</strong><br>${c.adminNotes}
                        </div>` : ''}
                    </div>

                    <div class="mb-4">
                        <h3 class="text-xl font-bold mb-3" style="color: var(--gold-primary);">ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                        <div class="grid md:grid-cols-2 gap-3">
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø£Ù†Ø´Ø£Ù‡Ø§:</strong> ${c.createdByRole} (${c.createdBy})</div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</strong> ${new Date(c.updatedAt).toLocaleString('ar-EG')}</div>
                        </div>
                    </div>
                </div>
            </div>`;
            
            document.body.insertAdjacentHTML('beforeend', html);
        }

        function deleteComplaint(id) {
            if (currentUser.role !== 'admin') {
                showNotification('âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©', 'error');
                return;
            }
            if (!confirm('âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø´ÙƒÙˆÙ‰ØŸ')) return;
            complaints = complaints.filter(c => c.id !== id);
            saveData();
            renderComplaints();
            showNotification('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù', 'success');
        }

        function renderDashboard() {
            document.getElementById('totalCount').textContent = complaints.length;
            document.getElementById('pendingCount').textContent = complaints.filter(c => c.status === 'Pending').length;
            document.getElementById('resolvedCount').textContent = complaints.filter(c => c.status === 'Resolved').length;
            
            ['typeChart', 'statusChart', 'priorityChart', 'curriculumChart'].forEach(chartId => {
                const canvas = document.getElementById(chartId);
                if (canvas && canvas.chart) {
                    canvas.chart.destroy();
                }
            });

            const typeData = {};
            complaints.forEach(c => {
                typeData[c.type] = (typeData[c.type] || 0) + 1;
            });
            
            const typeCanvas = document.getElementById('typeChart');
            typeCanvas.chart = new Chart(typeCanvas, {
                type: 'bar',
                data: {
                    labels: Object.keys(typeData),
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰',
                        data: Object.values(typeData),
                        backgroundColor: ['#D4AF37', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
                }
            });

            const statusData = {
                'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±': complaints.filter(c => c.status === 'Pending').length,
                'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©': complaints.filter(c => c.status === 'In Progress').length,
                'ØªÙ… Ø§Ù„Ø­Ù„': complaints.filter(c => c.status === 'Resolved').length,
                'Ù…ØºÙ„Ù‚': complaints.filter(c => c.status === 'Closed').length
            };

            const statusCanvas = document.getElementById('statusChart');
            statusCanvas.chart = new Chart(statusCanvas, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusData),
                    datasets: [{
                        data: Object.values(statusData),
                        backgroundColor: ['#f59e0b', '#3b82f6', '#10b981', '#6b7280'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'bottom' } }
                }
            });

            const priorityData = {
                'Ø¹Ø§Ø¬Ù„ ğŸ”´': complaints.filter(c => (c.priority || 'Ù…ØªÙˆØ³Ø·') === 'Ø¹Ø§Ø¬Ù„').length,
                'Ù…Ø±ØªÙØ¹ ğŸŸ ': complaints.filter(c => (c.priority || 'Ù…ØªÙˆØ³Ø·') === 'Ù…Ø±ØªÙØ¹').length,
                'Ù…ØªÙˆØ³Ø· ğŸŸ¡': complaints.filter(c => (c.priority || 'Ù…ØªÙˆØ³Ø·') === 'Ù…ØªÙˆØ³Ø·').length,
                'Ù…Ù†Ø®ÙØ¶ ğŸŸ¢': complaints.filter(c => (c.priority || 'Ù…ØªÙˆØ³Ø·') === 'Ù…Ù†Ø®ÙØ¶').length
            };

            const priorityCanvas = document.getElementById('priorityChart');
            priorityCanvas.chart = new Chart(priorityCanvas, {
                type: 'pie',
                data: {
                    labels: Object.keys(priorityData),
                    datasets: [{
                        data: Object.values(priorityData),
                        backgroundColor: ['#ef4444', '#f59e0b', '#fbbf24', '#10b981'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'bottom' } }
                }
            });

            const curriculumData = {};
            complaints.forEach(c => {
                const key = c.subCurriculum ? `${c.curriculum} (${c.subCurriculum})` : c.curriculum;
                curriculumData[key] = (curriculumData[key] || 0) + 1;
            });

            const curriculumCanvas = document.getElementById('curriculumChart');
            curriculumCanvas.chart = new Chart(curriculumCanvas, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(curriculumData),
                    datasets: [{
                        data: Object.values(curriculumData),
                        backgroundColor: ['#D4AF37', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        function generateReport() {
            const fromDate = document.getElementById('fromDate').value;
            const toDate = document.getElementById('toDate').value;

            let filtered = complaints;
            if (fromDate) {
                filtered = filtered.filter(c => new Date(c.createdAt) >= new Date(fromDate));
            }
            if (toDate) {
                filtered = filtered.filter(c => new Date(c.createdAt) <= new Date(toDate));
            }

            let html = `
                <div class="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-xl" style="border: 2px solid var(--gold-primary);" id="printableReport">
                    <div class="text-center mb-6">
                        <img src="logo.png" alt="Logo" style="height: 80px; width: auto; margin: 0 auto;">
                        <h3 class="text-3xl font-bold mt-4" style="color: var(--gold-dark);"></h3>
                        <p class="text-gray-600 dark:text-gray-400 mt-2">
                            ${fromDate ? `Ù…Ù† ${new Date(fromDate).toLocaleDateString('ar-EG')}` : ''} 
                            ${toDate ? `Ø¥Ù„Ù‰ ${new Date(toDate).toLocaleDateString('ar-EG')}` : ''}
                        </p>
                    </div>
                    
                    <div class="grid md:grid-cols-4 gap-4 mb-6">
                        <div class="p-6 rounded-xl text-center" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white;">
                            <h4 class="font-semibold mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</h4>
                            <p class="text-4xl font-bold">${filtered.length}</p>
                        </div>
                        <div class="p-6 rounded-xl text-center" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                            <h4 class="font-semibold mb-2">ØªÙ… Ø§Ù„Ø­Ù„</h4>
                            <p class="text-4xl font-bold">${filtered.filter(c => c.status === 'Resolved').length}</p>
                        </div>
                        <div class="p-6 rounded-xl text-center" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;">
                            <h4 class="font-semibold mb-2">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</h4>
                            <p class="text-4xl font-bold">${filtered.filter(c => c.status === 'In Progress').length}</p>
                        </div>
                        <div class="p-6 rounded-xl text-center" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white;">
                            <h4 class="font-semibold mb-2">Ø¹Ø§Ø¬Ù„</h4>
                            <p class="text-4xl font-bold">${filtered.filter(c => (c.priority || 'Ù…ØªÙˆØ³Ø·') === 'Ø¹Ø§Ø¬Ù„').length}</p>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h4 class="font-bold mb-3 text-xl" style="color: var(--gold-dark);">ğŸ“Œ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹:</h4>
                            <ul class="space-y-2">`;

            const types = {};
            filtered.forEach(c => {
                types[c.type] = (types[c.type] || 0) + 1;
            });

            Object.entries(types).forEach(([type, count]) => {
                const percentage = filtered.length > 0 ? ((count / filtered.length) * 100).toFixed(1) : 0;
                html += `<li class="flex justify-between items-center p-4 rounded-lg" style="background: linear-gradient(135deg, var(--gold-light) 0%, #fff 100%);">
                    <span class="font-semibold">${type}</span>
                    <div class="flex items-center gap-3">
                        <span class="text-gray-600">${percentage}%</span>
                        <span class="font-bold text-xl" style="color: var(--gold-dark);">${count}</span>
                    </div>
                </li>`;
            });

            html += `</ul></div>
                        <div>
                            <h4 class="font-bold mb-3 text-xl" style="color: var(--gold-dark);">ğŸ¯ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:</h4>
                            <ul class="space-y-2">`;

            const priorities = {
                'Ø¹Ø§Ø¬Ù„ ğŸ”´': filtered.filter(c => (c.priority || 'Ù…ØªÙˆØ³Ø·') === 'Ø¹Ø§Ø¬Ù„').length,
                'Ù…Ø±ØªÙØ¹ ğŸŸ ': filtered.filter(c => (c.priority || 'Ù…ØªÙˆØ³Ø·') === 'Ù…Ø±ØªÙØ¹').length,
                'Ù…ØªÙˆØ³Ø· ğŸŸ¡': filtered.filter(c => (c.priority || 'Ù…ØªÙˆØ³Ø·') === 'Ù…ØªÙˆØ³Ø·').length,
                'Ù…Ù†Ø®ÙØ¶ ğŸŸ¢': filtered.filter(c => (c.priority || 'Ù…ØªÙˆØ³Ø·') === 'Ù…Ù†Ø®ÙØ¶').length
            };

            Object.entries(priorities).forEach(([priority, count]) => {
                const percentage = filtered.length > 0 ? ((count / filtered.length) * 100).toFixed(1) : 0;
                html += `<li class="flex justify-between items-center p-4 rounded-lg" style="background: linear-gradient(135deg, var(--gold-light) 0%, #fff 100%);">
                    <span class="font-semibold">${priority}</span>
                    <div class="flex items-center gap-3">
                        <span class="text-gray-600">${percentage}%</span>
                        <span class="font-bold text-xl" style="color: var(--gold-dark);">${count}</span>
                    </div>
                </li>`;
            });

            html += `</ul></div></div>
                    
                    <div class="text-center mt-6">
                        <p class="text-sm text-gray-500 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-EG')}</p>
                        <p class="text-sm text-gray-500 mb-4">ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø©: ${currentUser.username} (${currentUser.roleName})</p>
                        <div class="flex gap-4 justify-center print-hide">
                            <button onclick="printReport()" class="btn-primary">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                            <button onclick="exportReportExcel()" class="btn-primary">ğŸ“¥ ØªØµØ¯ÙŠØ± Excel</button>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('reportOutput').innerHTML = html;
        }

        function printReport() {
            window.print();
        }

        function exportReportExcel() {
            const fromDate = document.getElementById('fromDate').value;
            const toDate = document.getElementById('toDate').value;

            let filtered = complaints;
            if (fromDate) {
                filtered = filtered.filter(c => new Date(c.createdAt) >= new Date(fromDate));
            }
            if (toDate) {
                filtered = filtered.filter(c => new Date(c.createdAt) <= new Date(toDate));
            }

            const data = filtered.map(c => ({
                'Ø±Ù‚Ù… Ø§Ù„Ø´ÙƒÙˆÙ‰': c.id,
                'Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨': c.studentName,
                'Ø§Ù„Ù†Ø¸Ø§Ù…': c.curriculum + (c.subCurriculum ? ` (${c.subCurriculum})` : ''),
                'Ø§Ù„ØµÙ': c.grade,
                'Ø§Ù„ÙØµÙ„': c.section || '-',
                'ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±': c.guardianName,
                'Ø§Ù„Ù‡Ø§ØªÙ': c.phone,
                'Ø§Ù„Ø¨Ø±ÙŠØ¯': c.email || '-',
                'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©': c.type,
                'Ø§Ù„Ù‚Ø³Ù…': c.department,
                'Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©': c.priority || 'Ù…ØªÙˆØ³Ø·',
                'Ø§Ù„Ø­Ø§Ù„Ø©': c.status,
                'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„': c.assignedTo || 'ØºÙŠØ± Ù…Ø¹ÙŠÙ†',
                'Ø§Ù„ÙˆØµÙ': c.description,
                'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©': c.adminNotes || '-',
                'Ø£Ù†Ø´Ø£Ù‡Ø§': c.createdByRole,
                'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡': new Date(c.createdAt).toLocaleDateString('ar-EG'),
                'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«': new Date(c.updatedAt).toLocaleDateString('ar-EG')
            }));

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰");
            
            const fileName = `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            showNotification('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function exportToExcel() {
            const data = complaints.map(c => ({
                'Ø±Ù‚Ù… Ø§Ù„Ø´ÙƒÙˆÙ‰': c.id,
                'Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨': c.studentName,
                'Ø§Ù„Ù†Ø¸Ø§Ù…': c.curriculum + (c.subCurriculum ? ` (${c.subCurriculum})` : ''),
                'Ø§Ù„ØµÙ': c.grade,
                'Ø§Ù„ÙØµÙ„': c.section || '-',
                'ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±': c.guardianName,
                'Ø§Ù„Ù‡Ø§ØªÙ': c.phone,
                'Ø§Ù„Ø¨Ø±ÙŠØ¯': c.email || '-',
                'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©': c.type,
                'Ø§Ù„Ù‚Ø³Ù…': c.department,
                'Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©': c.priority || 'Ù…ØªÙˆØ³Ø·',
                'Ø§Ù„Ø­Ø§Ù„Ø©': c.status,
                'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„': c.assignedTo || 'ØºÙŠØ± Ù…Ø¹ÙŠÙ†',
                'Ø§Ù„ÙˆØµÙ': c.description,
                'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©': c.adminNotes || '-',
                'Ø£Ù†Ø´Ø£Ù‡Ø§': c.createdByRole,
                'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡': new Date(c.createdAt).toLocaleDateString('ar-EG'),
                'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«': new Date(c.updatedAt).toLocaleDateString('ar-EG')
            }));

            const ws = XLSX.utils.json_to_sheet(data);
            
            const colWidths = [
                { wch: 15 }, // Ø±Ù‚Ù… Ø§Ù„Ø´ÙƒÙˆÙ‰
                { wch: 20 }, // Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨
                { wch: 15 }, // Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨
                { wch: 20 }, // Ø§Ù„Ù†Ø¸Ø§Ù…
                { wch: 12 }, // Ø§Ù„ØµÙ
                { wch: 12 }, // Ø§Ù„ÙØµÙ„
                { wch: 20 }, // ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
                { wch: 15 }, // Ø§Ù„Ù‡Ø§ØªÙ
                { wch: 25 }, // Ø§Ù„Ø¨Ø±ÙŠØ¯
                { wch: 15 }, // Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
                { wch: 15 }, // Ø§Ù„Ù‚Ø³Ù…
                { wch: 12 }, // Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
                { wch: 15 }, // Ø§Ù„Ø­Ø§Ù„Ø©
                { wch: 20 }, // Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
                { wch: 40 }, // Ø§Ù„ÙˆØµÙ
                { wch: 30 }, // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                { wch: 15 }, // Ø£Ù†Ø´Ø£Ù‡Ø§
                { wch: 15 }, // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
                { wch: 15 }  // Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«
            ];
            ws['!cols'] = colWidths;

            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰");
            
            const fileName = `Ø¬Ù…ÙŠØ¹_Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            showNotification('âœ… ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function showNotification(message, type = 'success') {
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        loadData();
        checkAuth();
    </script>
</body>
</html>
